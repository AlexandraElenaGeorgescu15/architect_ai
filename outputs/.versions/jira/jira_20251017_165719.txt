```markdown
# EPIC: Implement Phone Swap Request Feature

**Epic Description:** This epic encompasses all tasks related to implementing the "Phone Swap Request" feature, allowing users to request a phone from the available list and offer one of their current phones in exchange.

**Story Points:** 20

## Story 1: Implement "Request Phone Swap" Button and Modal (PP-002A)

**Story Type:** Feature

**Priority:** High

**Story Points:** 5

**Assignee:** Alexandra (AI/GenAI + Streamlit)

**Labels:** `frontend`, `angular`, `phone-swap`, `modal`

**As a** user
**I want to** see a "Request Phone Swap" button on the phone panel page
**So that** I can easily initiate the phone swap request process.

### Description

Implement the "Request Phone Swap" button on the main phone list page and create the basic modal structure.

### Acceptance Criteria

*   ✅ **Button Visibility**: Given I am on the `/phones` route, When the page loads, Then I should see a "Request Phone Swap" button.
*   ✅ **Modal Opens**: Given I am on the `/phones` route and I see the "Request Phone Swap" button, When I click the button, Then a modal/popup should appear.
*   ✅ **Modal Structure**: Given the modal is open, Then it should contain a form with "Phone to Request," "Phone to Exchange," and "Reason for Request" fields.

### Subtask 1.1: Create "Request Phone Swap" Button Component (PP-002A1)

**Estimate:** 2 points

**Assignee:** Alexandra (AI/GenAI + Streamlit)

**Tasks:**

*   [ ] Create a new Angular component for the "Request Phone Swap" button.
*   [ ] Style the button to match the existing User Panel visual language (spacing, typography, card shadows, elevation, etc.).
*   [ ] Place the button on the `/phones` route, likely near the "Add Phone" button.

**Acceptance Criteria:**

*   ✅ Button component exists.
*   ✅ Button is styled according to existing UI patterns.
*   ✅ Button is placed correctly on the `/phones` route.

### Subtask 1.2: Implement Modal Structure (PP-002A2)

**Estimate:** 3 points

**Assignee:** Alexandra (AI/GenAI + Streamlit)

**Tasks:**

*   [ ] Create an Angular Material Dialog component.
*   [ ] Define the basic structure of the modal, including form fields (Phone to Request, Phone to Exchange, Reason for Request), Submit Request, and Cancel buttons.
*   [ ] Ensure the modal overlays the current view.
*   [ ] Reuse visual language from User Panel for modal design.
    *   Spacing: 8px/16px/24px
    *   Cards: 12px border radius, same elevation
    *   Typography: Same font scale as User Panel

**Acceptance Criteria:**

*   ✅ Modal component exists and is correctly implemented as an Angular Material Dialog.
*   ✅ Modal contains the required form fields and buttons.
*   ✅ Modal correctly overlays the current view.
*   ✅ Modal styling matches the User Panel visual language.

## Story 2: Implement Backend API for Phone Swap Requests (PP-002B)

**Story Type:** Feature

**Priority:** High

**Story Points:** 8

**Assignee:** Backend Team

**Labels:** `backend`, `api`, `phone-swap`, `database`

**As a** backend developer
**I want to** create a new API endpoint to handle phone swap requests
**So that** users can submit their swap requests and have them stored in the database.

### Description

Develop the new API endpoint (POST /api/phone-swaps) and database schema to handle form submissions for phone swap requests.

### Acceptance Criteria

*   ✅ **API Endpoint Exists**: Given the backend service is running, When I send a POST request to `/api/phone-swaps`, Then the endpoint should exist and respond.
*   ✅ **Data Storage**: Given I send a valid POST request to `/api/phone-swaps`, When the request is processed, Then the swap request should be stored in a new database table.
*   ✅ **User Ownership Validation**: Given I send a POST request to `/api/phone-swaps`, When the request is processed, Then the backend should validate that the user making the request owns the offered phone.

### Subtask 2.1: Design and Implement Database Schema (PP-002B1)

**Estimate:** 3 points

**Assignee:** Backend Team

**Tasks:**

*   [ ] Design the database schema for the "Swap Request" table.
*   [ ] Implement the database schema in the chosen database.
    *   Fields: Requester's ID (user ID), Requested Phone (phone ID), Offered Phone (phone ID), Status (defaulting to 'Pending'), Comment (text)

**Acceptance Criteria:**

*   ✅ Database schema exists and is correctly implemented.
*   ✅ The "Swap Request" table contains the required fields.

### Subtask 2.2: Implement API Endpoint (POST /api/phone-swaps) (PP-002B2)

**Estimate:** 5 points

**Assignee:** Backend Team

**Tasks:**

*   [ ] Create a new API endpoint (POST /api/phone-swaps) to handle form submissions.
*   [ ] Implement authentication and validation of user ownership of the offered phone.
*   [ ] Store swap requests in the database.
*   [ ] Handle potential errors and return appropriate error messages.

**Acceptance Criteria:**

*   ✅ API endpoint exists and is accessible via POST request.
*   ✅ Endpoint handles authentication and validates user ownership.
*   ✅ Swap requests are successfully stored in the database.
*   ✅ Endpoint returns appropriate error messages for invalid requests.

## Story 3: Connect Frontend Modal to Backend API (PP-002C)

**Story Type:** Feature

**Priority:** High

**Story Points:** 7

**Assignee:** Alexandra (AI/GenAI + Streamlit)

**Labels:** `frontend`, `angular`, `api`, `integration`

**As a** frontend developer
**I want to** connect the modal to the backend API
**So that** swap requests can be submitted and processed.

### Description

Connect the frontend modal to the backend API to handle form submissions for phone swap requests.

### Acceptance Criteria

*   ✅ **Data Submission**: Given the modal is open and the form is filled out, When I click the "Submit Request" button, Then the form data should be sent to the `/api/phone-swaps` endpoint.
*   ✅ **Confirmation Message**: Given I successfully submit a phone swap request, When the request is processed, Then a confirmation message should be displayed in the UI.
*   ✅ **Modal Closure**: Given I successfully submit a phone swap request, When the request is processed, Then the modal should close automatically.

### Subtask 3.1: Integrate Frontend Form with Backend API (PP-002C1)

**Estimate:** 4 points

**Assignee:** Alexandra (AI/GenAI + Streamlit)

**Tasks:**

*   [ ] Implement the API call to `/api/phone-swaps` when the "Submit Request" button is clicked.
*   [ ] Pass the form data (Requester's ID, Requested Phone, Offered Phone, Comment) to the API endpoint.
*   [ ] Handle the API response (success or error).
*   [ ] Implement error handling in the modal.

**Acceptance Criteria:**

*   ✅ Form data is correctly sent to the API endpoint.
*   ✅ API response is correctly handled.
*   ✅ Errors are displayed in the modal.

### Subtask 3.2: Implement Confirmation Message and Modal Closure (PP-002C2)

**Estimate:** 3 points

**Assignee:** Alexandra (AI/GenAI + Streamlit)

**Tasks:**

*   [ ] Display a confirmation message upon successful submission.
*   [ ] Close the modal automatically after the confirmation message is displayed.

**Acceptance Criteria:**

*   ✅ A confirmation message is displayed upon successful submission.
*   ✅ The modal closes automatically after the confirmation message is displayed.

```
